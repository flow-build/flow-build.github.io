(self.webpackChunkworkflow=self.webpackChunkworkflow||[]).push([[7715],{3905:function(e,a,o){"use strict";o.d(a,{Zo:function(){return l},kt:function(){return m}});var t=o(7294);function r(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function n(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,t)}return o}function s(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?n(Object(o),!0).forEach((function(a){r(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function i(e,a){if(null==e)return{};var o,t,r=function(e,a){if(null==e)return{};var o,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)o=n[t],a.indexOf(o)>=0||(r[o]=e[o]);return r}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)o=n[t],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var c=t.createContext({}),d=function(e){var a=t.useContext(c),o=a;return e&&(o="function"==typeof e?e(a):s(s({},a),e)),o},l=function(e){var a=d(e.components);return t.createElement(c.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},p=t.forwardRef((function(e,a){var o=e.components,r=e.mdxType,n=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=d(o),m=r,f=p["".concat(c,".").concat(m)]||p[m]||u[m]||n;return o?t.createElement(f,s(s({ref:a},l),{},{components:o})):t.createElement(f,s({ref:a},l))}));function m(e,a){var o=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var n=o.length,s=new Array(n);s[0]=p;var i={};for(var c in a)hasOwnProperty.call(a,c)&&(i[c]=a[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var d=2;d<n;d++)s[d]=o[d];return t.createElement.apply(null,s)}return t.createElement.apply(null,o)}p.displayName="MDXCreateElement"},4327:function(e,a,o){"use strict";o.r(a),o.d(a,{frontMatter:function(){return i},metadata:function(){return c},toc:function(){return d},default:function(){return u}});var t=o(2122),r=o(9756),n=(o(7294),o(3905)),s=["components"],i={},c={unversionedId:"documentation/faq/conexao",id:"documentation/faq/conexao",isDocsHomePage:!1,title:"Como conectar minha aplica\xe7\xe3o ao flowbuild",description:"H\xe1 2 formas de conectar sua aplica\xe7\xe3o ao flowbuild para executar tarefas descritas em um processo.",source:"@site/docs/documentation/faq/conexao.md",sourceDirName:"documentation/faq",slug:"/documentation/faq/conexao",permalink:"/docs/documentation/faq/conexao",editUrl:"https://bitbucket.org/fdtedsd/workflow-api-doc/src/master/docs/documentation/faq/conexao.md",version:"current",frontMatter:{}},d=[{value:"Tarefas S\xedncronas",id:"tarefas-s\xedncronas",children:[]},{value:"Tarefas Ass\xedncronas",id:"tarefas-ass\xedncronas",children:[{value:"Pub/Sub Broker",id:"pubsub-broker",children:[]},{value:"Mensagens",id:"mensagens",children:[]},{value:"T\xf3picos",id:"t\xf3picos",children:[]},{value:"Consulta",id:"consulta",children:[]},{value:"Webhook",id:"webhook",children:[]}]}],l={toc:d};function u(e){var a=e.components,o=(0,r.Z)(e,s);return(0,n.kt)("wrapper",(0,t.Z)({},l,o,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"H\xe1 2 formas de conectar sua aplica\xe7\xe3o ao flowbuild para executar tarefas descritas em um processo."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Tarefas S\xedncronas: nesse caso a engine de execu\xe7\xe3o do ficar\xe1 ativamente aguardando a sinaliza\xe7\xe3o do t\xe9rmino da execu\xe7\xe3o da tarefas."),(0,n.kt)("li",{parentName:"ol"},"Tarefas Ass\xedncronas: nesse caso a engine colocar\xe1 o processo em pausa e aguardar\xe1 de forma passiva a execu\xe7\xe3o do processo.")),(0,n.kt)("h2",{id:"tarefas-s\xedncronas"},"Tarefas S\xedncronas"),(0,n.kt)("p",null,"A forma mais comum de integra\xe7\xe3o de tarefas s\xedncronas \xe9 via uma API REST. "),(0,n.kt)("p",null,"A designer do processo, quando quiser executar aquela tarefa, incluir\xe1 uma system task HTTP que acionar\xe1 a execu\xe7\xe3o. O motor do workflow permanecer\xe1 aguardando (at\xe9 o limite do timeout estabelecido na tarefa) e assim que a resposta for recebida o processo segue."),(0,n.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,n.kt)("div",{parentName:"div",className:"admonition-heading"},(0,n.kt)("h5",{parentName:"div"},(0,n.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,n.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,n.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Nota")),(0,n.kt)("div",{parentName:"div",className:"admonition-content"},(0,n.kt)("p",{parentName:"div"},"Atualmente o flowbuild n\xe3o suporta o uso de APIs SOAP, gRPC e GraphQL para execu\xe7\xe3o de tarefas s\xedncronas"))),(0,n.kt)("p",null,"N\xe3o h\xe1 necessidade de nenhuma configura\xe7\xe3o especial na aplica\xe7\xe3o do flowbuild para integra\xe7\xe3o de tarefas s\xedncronas usando chamadas HTTP."),(0,n.kt)("h2",{id:"tarefas-ass\xedncronas"},"Tarefas Ass\xedncronas"),(0,n.kt)("p",null,"Em alguns casos, tarefas podem ser demoradas e, por esse motivo, \xe9 desej\xe1vel o uso de tarefas ass\xedncronas."),(0,n.kt)("p",null,"Nessa situa\xe7\xe3o, o designer de processo, caso queira incluir tal tarefa em seu processo, incluir\xe1 uma user task. Veja que, apesar do elemento ser nomeado como uma tarefa de usu\xe1rio, esse tipo de tarefa pode ser aplicado para todo tipo de tarefa ass\xedncrona."),(0,n.kt)("p",null,"A integra\xe7\xe3o, nesse caso, ocorrer\xe1 da seguinte forma:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"assim que o processo chegar na tarefa, a engine do flowbuild pausar\xe1 o processo e criar\xe1 um activity manager."),(0,n.kt)("li",{parentName:"ul"},"o server do flowbuild, diante a cria\xe7\xe3o do activity manager, publicar\xe1 uma mensagem em um broker pub/sub contendo dados do activity manager criado."),(0,n.kt)("li",{parentName:"ul"},"o server do flowbuild criar\xe1 um webhook para receber atualiza\xe7\xf5es do activity manager criado.")),(0,n.kt)("p",null,"O processo permanecer\xe1 em estado de pausa at\xe9 que:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"o server do flowbuild receba, no webhook, uma mensagem v\xe1lida da finaliza\xe7\xe3o da tarefa."),(0,n.kt)("li",{parentName:"ul"},"a tarefa atinja o timeout determinado pelo designer do processo.")),(0,n.kt)("h3",{id:"pubsub-broker"},"Pub/Sub Broker"),(0,n.kt)("p",null,"Atualmente o flowbuild utiliza um Broker Pub/Sub MQTT para envio das mensagens de cria\xe7\xe3o de activity managers."),(0,n.kt)("p",null,"Espera-se que o executor de tarefas (client) se conecte aos t\xf3picos conhecidos para que seja notificado em caso de novas tarefas a serem executadas. "),(0,n.kt)("p",null,"Consulte a documenta\xe7\xe3o de clients MQTT ",(0,n.kt)("a",{parentName:"p",href:"https://www.hivemq.com/mqtt-client-library-encyclopedia/"},"aqui"),"."),(0,n.kt)("p",null,"A priori o broker MQTT ficar\xe1 dispon\xedvel em ",(0,n.kt)("inlineCode",{parentName:"p"},"ws.your_flowbuild_server:8000/mqtt"),"."),(0,n.kt)("h3",{id:"mensagens"},"Mensagens"),(0,n.kt)("p",null,"As mensagens postadas nos t\xf3picos cont\xe9m, somente:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"process_id"),(0,n.kt)("li",{parentName:"ul"},"id = id do activity manager"),(0,n.kt)("li",{parentName:"ul"},"props = dados para execu\xe7\xe3o da tarefa, como definido pelo designer do processo.")),(0,n.kt)("h3",{id:"t\xf3picos"},"T\xf3picos"),(0,n.kt)("p",null,"As mensagens do activity manager s\xe3o sempre publicadas em 3 t\xf3picos"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"/process/:process_id/am/create"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Nesse caso, \xe9 previsto que o cliente, o executor da tarefa, tem conhecimento pr\xe9vio do id do processo - talvez porque esteja envolvido na cria\xe7\xe3o do processo em si."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"/session/:session_id/am/create"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"A mensagem \xe9 postada nesse t\xf3pico se o designer do processo passou a propriedade session id no activity manager."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"/actor/:actor_id/am/create"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"A mensagem \xe9 postada nesse t\xf3pico se o designer do processo passou a propriedade actor id no activity manager ou se na implementa\xe7\xe3o do flowbuild foi implementado um servi\xe7o de gest\xe3o de usu\xe1rios.")))),(0,n.kt)("h3",{id:"consulta"},"Consulta"),(0,n.kt)("p",null,"Outra forma para um executor acompanhar a exist\xeancia de tarefas \xe9 atrav\xe9s dos endpoints de ",(0,n.kt)("a",{parentName:"p",href:"/docs/resources/api/activityManagers"},"consulta de tarefas")," do flowbuild."),(0,n.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,n.kt)("div",{parentName:"div",className:"admonition-heading"},(0,n.kt)("h5",{parentName:"div"},(0,n.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,n.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,n.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,n.kt)("div",{parentName:"div",className:"admonition-content"},(0,n.kt)("p",{parentName:"div"},"Para realizar o acompanhamento de tarefas usando os endpoints de consultas \xe9 necess\xe1rio fazer um data polling. Tenha cuidado com essa implementa\xe7\xe3o, verificando sempre o status do processo consultado."))),(0,n.kt)("h3",{id:"webhook"},"Webhook"),(0,n.kt)("p",null,"Para cada activity manager criado, 3 a\xe7\xf5es s\xe3o disponibilizadas"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/resources/api/activityManagers#salvar-uma-atividade"},"Salvar a atividade"),": permite atualizar o status da atividade, sem atualiza\xe7\xe3o do processo relacionado.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"A atividade s\xf3 ser\xe1 salva caso o payload enviado esteja de acordo com o esquema definido pelo designer do processo."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/resources/api/activityManagers#enviar-uma-atividade"},"Enviar uma atividade"),": informa a conclus\xe3o da atividade. Ap\xf3s o envio desse evento o processo prosseguir\xe1 sua execu\xe7\xe3o.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"O envio da atividade presume que a atividade foi previamente atualizada."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/resources/api/activityManagers#submeter-uma-atividade"},"Submeter uma atividade"),": nesse caso, a atividade \xe9 atualizada e enviada em um \xfanico comando.")))}u.isMDXComponent=!0}}]);